-- Universal Kick Script (LMB Version)
-- Allows you to kick the ball regardless of who currently has possession

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local ContextActionService = game:GetService("ContextActionService")

-- Configuration
local COOLDOWN_TIME = 0.3

local lastKickTime = 0
local isMouseButtonDown = false

-- Create kick effect
local function createKickEffect(position)
    local effect = Instance.new("Part")
    effect.Name = "KickEffect"
    effect.Size = Vector3.new(1, 1, 1)
    effect.BrickColor = BrickColor.new("Bright blue")
    effect.Material = Enum.Material.Neon
    effect.Anchored = true
    effect.CanCollide = false
    effect.Transparency = 0.3
    effect.Position = position
    effect.Parent = Workspace

    local startTime = tick()
    local connection

    connection = RunService.Heartbeat:Connect(function()
        local elapsed = tick() - startTime

        if elapsed > 0.4 then
            effect:Destroy()
            connection:Disconnect()
            return
        end

        effect.Transparency = 0.3 + elapsed * 1.75
        effect.Size = Vector3.new(1 + elapsed * 3, 1 + elapsed * 3, 1 + elapsed * 3)
    end)
end

-- Get ball object
local function getBall()
    return Workspace:FindFirstChild("SoccerBall")
end

-- Get ball owner
local function getBallOwner()
    local ball = getBall()
    if not ball then return nil end

    local ownerValue = ball:FindFirstChild("Owner")
    if ownerValue and ownerValue:IsA("StringValue") then
        return Players:FindFirstChild(ownerValue.Value)
    end

    return nil
end

-- Force kick the ball
local function forceKickBall()
    local now = tick()
    if now - lastKickTime < COOLDOWN_TIME then return false end

    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return false end

    local ball = getBall()
    if not ball then return false end

    -- Set you as the owner of the ball so you can kick it
    local ownerValue = ball:FindFirstChild("Owner")
    if ownerValue then
        ownerValue.Value = LocalPlayer.Name
    end
    
    -- Create kick effect at ball position
    createKickEffect(ball.Position)
    
    lastKickTime = now
    
    return true
end

-- Create indicator
local function createIndicator()
    local part = Instance.new("Part")
    part.Name = "KickReadyIndicator"
    part.Size = Vector3.new(4, 0.1, 4)
    part.Material = Enum.Material.ForceField
    part.BrickColor = BrickColor.new("Bright blue")
    part.Anchored = true
    part.CanCollide = false
    part.Transparency = 0.7
    part.Parent = Workspace
    return part
end

local indicator = createIndicator()

-- Update indicator position
local function updateIndicator()
    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")

    if not hrp then
        indicator.Transparency = 1
        return
    end

    indicator.Position = hrp.Position - Vector3.new(0, 2.5, 0)
    indicator.Transparency = 0.7
    
    -- Show indicator whenever cooldown is ready
    local now = tick()
    if now - lastKickTime >= COOLDOWN_TIME then
        indicator.BrickColor = BrickColor.new("Bright blue")
        indicator.Transparency = 0.4
    else
        indicator.BrickColor = BrickColor.new("Dark stone grey")
        indicator.Transparency = 0.7
    end
end

-- LMB (Left Mouse Button) handler
local function onMouseButtonInput(input, gameProcessed)
    if gameProcessed then return end
    
    -- Check for MouseButton1 (Left Mouse Button)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        if input.UserInputState == Enum.UserInputState.Begin then
            isMouseButtonDown = true
            forceKickBall()
        elseif input.UserInputState == Enum.UserInputState.End then
            isMouseButtonDown = false
        end
    end
end

-- Handle continuous clicking (if user holds LMB)
local function handleContinuousKick()
    while task.wait(0.05) do
        if isMouseButtonDown then
            forceKickBall()
        end
    end
end

RunService.Heartbeat:Connect(updateIndicator)

-- Connect mouse input
UserInputService.InputBegan:Connect(onMouseButtonInput)
UserInputService.InputEnded:Connect(onMouseButtonInput)

-- Auto-kick loop - continuously takes ball ownership
local function autoKickLoop()
    while task.wait(0.1) do
        -- Check if someone else has the ball
        local currentOwner = getBallOwner()
        local ball = getBall()
        
        if ball and currentOwner and currentOwner ~= LocalPlayer then
            -- Force take ownership of the ball
            local ownerValue = ball:FindFirstChild("Owner")
            if ownerValue then
                ownerValue.Value = LocalPlayer.Name
            end
        end
    end
end

-- Start auto-kick loop and continuous kick handler
coroutine.wrap(autoKickLoop)()
coroutine.wrap(handleContinuousKick)()

-- Bind context action as backup (optional)
ContextActionService:BindAction("ForceKick", function(actionName, inputState, inputObject)
    if inputState == Enum.UserInputState.Begin then
        forceKickBall()
    end
    return Enum.ContextActionResult.Sink
end, false, Enum.UserInputType.MouseButton1)

print("Universal Kick Script Loaded - Click LMB to take ball ownership!")
